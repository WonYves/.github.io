<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux | Wiess&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/ohwo.png">
    <meta name="description" content="分享笔记，技术博客">
    
    <link rel="preload" href="/assets/css/0.styles.d6ad21ed.css" as="style"><link rel="preload" href="/assets/js/app.2e62b62d.js" as="script"><link rel="preload" href="/assets/js/2.63c13255.js" as="script"><link rel="preload" href="/assets/js/19.40c015fe.js" as="script"><link rel="prefetch" href="/assets/js/10.f349bc64.js"><link rel="prefetch" href="/assets/js/11.146fca84.js"><link rel="prefetch" href="/assets/js/12.521b5f2b.js"><link rel="prefetch" href="/assets/js/13.37d1ba2a.js"><link rel="prefetch" href="/assets/js/14.9ccbfb79.js"><link rel="prefetch" href="/assets/js/15.885784e2.js"><link rel="prefetch" href="/assets/js/16.2429ce04.js"><link rel="prefetch" href="/assets/js/17.c08428cb.js"><link rel="prefetch" href="/assets/js/18.eac4fdce.js"><link rel="prefetch" href="/assets/js/20.f61ad29a.js"><link rel="prefetch" href="/assets/js/21.b02763da.js"><link rel="prefetch" href="/assets/js/22.468a8aa1.js"><link rel="prefetch" href="/assets/js/23.dcb1dc2f.js"><link rel="prefetch" href="/assets/js/24.0a318d52.js"><link rel="prefetch" href="/assets/js/25.6474b7e9.js"><link rel="prefetch" href="/assets/js/26.93b09730.js"><link rel="prefetch" href="/assets/js/27.d788553f.js"><link rel="prefetch" href="/assets/js/28.38bcdbc1.js"><link rel="prefetch" href="/assets/js/29.ce6659b7.js"><link rel="prefetch" href="/assets/js/3.8511b05c.js"><link rel="prefetch" href="/assets/js/4.94733d25.js"><link rel="prefetch" href="/assets/js/5.2ea06e07.js"><link rel="prefetch" href="/assets/js/6.8d81f0ec.js"><link rel="prefetch" href="/assets/js/7.09227dd3.js"><link rel="prefetch" href="/assets/js/8.aa48b1f5.js"><link rel="prefetch" href="/assets/js/9.03db83aa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6ad21ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Wiess's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/react.html" class="nav-link">
  React基础语法
</a></li><li class="dropdown-item"><!----> <a href="/React/hook.html" class="nav-link">
  React-Hooks
</a></li><li class="dropdown-item"><!----> <a href="/React/Redux.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/React/React-Router.html" class="nav-link">
  React-Router
</a></li><li class="dropdown-item"><!----> <a href="/talk/react-hooks中的过期闭包问题.html" class="nav-link">
  react-hooks中的过期闭包问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/Vue双向绑定原理.html" class="nav-link">
  Vue双向绑定
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/浅拷贝和深拷贝.html" class="nav-link">
  浅拷贝和深拷贝
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件循环Eventloop.html" class="nav-link">
  事件循环EventLoop
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/重绘回流.html" class="nav-link">
  重绘回流(重排)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/call、apply、bind方法.html" class="nav-link">
  call、apply、bind方法
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript.html" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebPack" class="dropdown-title"><span class="title">WebPack</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebPack" class="mobile-dropdown-title"><span class="title">WebPack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WebPack/WebPack.html" class="nav-link">
  WebPack入门基础
</a></li><li class="dropdown-item"><!----> <a href="/WebPack/WebPack面试题.html" class="nav-link">
  WebPack面试题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据结构与算法" class="mobile-dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Algorithm/数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/Algorithm/栈和队列.html" class="nav-link">
  栈和队列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Css" class="dropdown-title"><span class="title">Css</span> <span class="arrow down"></span></button> <button type="button" aria-label="Css" class="mobile-dropdown-title"><span class="title">Css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Css/CSS.html" class="nav-link">
  Css基础+css3
</a></li><li class="dropdown-item"><!----> <a href="/Css/css属性.html" class="nav-link">
  Css常用属性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便聊聊" class="dropdown-title"><span class="title">随便聊聊</span> <span class="arrow down"></span></button> <button type="button" aria-label="随便聊聊" class="mobile-dropdown-title"><span class="title">随便聊聊</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/talk/talk.html" class="nav-link">
  高频面试题
</a></li><li class="dropdown-item"><!----> <a href="/talk/git.html" class="nav-link">
  git使用
</a></li><li class="dropdown-item"><!----> <a href="/talk/小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/talk/Ajax、Fetch、Axios这三者有什么区别.html" class="nav-link">
  Ajax、Fetch、Axios这三者有什么区别
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/react.html" class="nav-link">
  React基础语法
</a></li><li class="dropdown-item"><!----> <a href="/React/hook.html" class="nav-link">
  React-Hooks
</a></li><li class="dropdown-item"><!----> <a href="/React/Redux.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/React/React-Router.html" class="nav-link">
  React-Router
</a></li><li class="dropdown-item"><!----> <a href="/talk/react-hooks中的过期闭包问题.html" class="nav-link">
  react-hooks中的过期闭包问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/Vue双向绑定原理.html" class="nav-link">
  Vue双向绑定
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/浅拷贝和深拷贝.html" class="nav-link">
  浅拷贝和深拷贝
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件循环Eventloop.html" class="nav-link">
  事件循环EventLoop
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/重绘回流.html" class="nav-link">
  重绘回流(重排)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/call、apply、bind方法.html" class="nav-link">
  call、apply、bind方法
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/TypeScript.html" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebPack" class="dropdown-title"><span class="title">WebPack</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebPack" class="mobile-dropdown-title"><span class="title">WebPack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WebPack/WebPack.html" class="nav-link">
  WebPack入门基础
</a></li><li class="dropdown-item"><!----> <a href="/WebPack/WebPack面试题.html" class="nav-link">
  WebPack面试题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据结构与算法" class="mobile-dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Algorithm/数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/Algorithm/栈和队列.html" class="nav-link">
  栈和队列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Css" class="dropdown-title"><span class="title">Css</span> <span class="arrow down"></span></button> <button type="button" aria-label="Css" class="mobile-dropdown-title"><span class="title">Css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Css/CSS.html" class="nav-link">
  Css基础+css3
</a></li><li class="dropdown-item"><!----> <a href="/Css/css属性.html" class="nav-link">
  Css常用属性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便聊聊" class="dropdown-title"><span class="title">随便聊聊</span> <span class="arrow down"></span></button> <button type="button" aria-label="随便聊聊" class="mobile-dropdown-title"><span class="title">随便聊聊</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/talk/talk.html" class="nav-link">
  高频面试题
</a></li><li class="dropdown-item"><!----> <a href="/talk/git.html" class="nav-link">
  git使用
</a></li><li class="dropdown-item"><!----> <a href="/talk/小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/talk/Ajax、Fetch、Axios这三者有什么区别.html" class="nav-link">
  Ajax、Fetch、Axios这三者有什么区别
</a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redux"><a href="#redux" class="header-anchor">#</a> Redux</h1> <p>提供可预测的状态管理</p> <p>redux 与 react 没有任何的关系，在 react 中需要使用 redux，则需要安装绑定库：react-redux。</p> <p>redux 采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。</p> <p>Redux 在以下情况下更有用：</p> <ul><li>在应用的大量地方，都存在大量的状态</li> <li>应用状态会随着时间的推移而频繁更新</li> <li>更新该状态的逻辑可能很复杂</li> <li>中型和大型代码量的应用，很多人协同开发</li></ul> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <ul><li>store - 仓库，集中式管理存储应用中各组件共享状态的地方</li> <li>state - 各组件需要共享的“状态”</li> <li>action - 是一个普通对象，通常用于描述发生了什么事情。一般在 action 对象中有两个属性：{ type, payload }，type 表明动作类型，payload 表示有效载荷</li> <li>action creator：action 创建函数，主要用于生成 action 对象，让你不必每次都手动编写 action 对象</li> <li>reducer：是一个<strong>纯函数</strong>，主要用于同步更新状态数据，这个函数会传递 state 和 action 作为参数，返回新的 state 对象</li></ul> <blockquote><p>Reducer 必需符合以下规则：</p> <ul><li>仅使用 <code>state</code> 和 <code>action</code> 参数计算新的状态值</li> <li>禁止直接修改 <code>state</code>。必须通过复制现有的 <code>state</code> 并对复制的值进行更改的方式来做 <em>不可变更新（immutable updates）</em>。</li> <li>禁止任何异步逻辑、依赖随机值或导致其他“副作用”的代码</li></ul></blockquote> <blockquote><p>reducer 函数内部的逻辑通常遵循以下步骤：</p> <ul><li>检查 reducer 是否关心这个 action</li> <li>如果是，则复制 state，使用新值更新 state 副本，然后返回新 state</li> <li>否则，返回原来的 state 不变</li></ul></blockquote> <ul><li>dispatch：reducer() 不能直接调用。dispatch(action) 用于触发 action 调用，在内部实现对 reducer() 的调用。<strong>更新 state 的唯一方法是调用 <strong><code>**store.dispatch()**</code></strong> 并传入一个 action 对象</strong>。</li></ul> <h2 id="三大原则"><a href="#三大原则" class="header-anchor">#</a> 三大原则</h2> <h3 id="单一数据源"><a href="#单一数据源" class="header-anchor">#</a> 单一数据源</h3> <p><strong>整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。</strong></p> <h3 id="state-是只读的"><a href="#state-是只读的" class="header-anchor">#</a> State 是只读的</h3> <p><strong>唯一改变 state 的方法就是触发 action，action 是一个用于描述已发生事件的普通对象。</strong></p> <h3 id="使用纯函数来执行修改"><a href="#使用纯函数来执行修改" class="header-anchor">#</a> 使用纯函数来执行修改</h3> <p><strong>为了描述 action 如何改变 state tree ，你需要编写 reducers。</strong></p> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i redux react-redux
<span class="token comment"># 或</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> redux react-redux
</code></pre></div><h3 id="创建-reducer"><a href="#创建-reducer" class="header-anchor">#</a> 创建 reducer</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./reducers/counter.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">DECREMENT</span><span class="token punctuation">,</span> <span class="token constant">INCREMENT</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../actions/constants&quot;</span>

<span class="token comment">/**
 * state 初始值
 */</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token comment">// 计数数量的状态数据</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * reducer 纯函数，用于实现状态的同步更新，返回更新后的新状态数据
 * @param {*} state 更新前的状态数据 
 * @param {*} action 描述发生了什么，有 type 与 payload 属性
 * @returns 
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">INCREMENT</span><span class="token operator">:</span> <span class="token comment">// 加数量</span>
      <span class="token keyword">const</span> copy <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state <span class="token punctuation">}</span> <span class="token comment">// 复制 state 值，实际应该进行深克隆</span>
      copy<span class="token punctuation">.</span>count <span class="token operator">+=</span> payload<span class="token punctuation">.</span>num <span class="token comment">// 对复制后的副本进行更新</span>
      <span class="token keyword">return</span> copy <span class="token comment">// 返回更新后的新状态数据</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer
</code></pre></div><p>reducer() 是一个纯函数，传递 state 与 action 作为参数，返回新的 state。在函数体内部不能直接更新参数 state，而应该对参数 state 进行深克隆，然后更新克隆后的副本。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./reducers/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">'./counter'</span>

<span class="token comment">// 将多个独立的 reducer 最终合并为一个根 reducer</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>将各独立的 reducer 合并为一个根 reducer</p> <h2 id="action-处理"><a href="#action-处理" class="header-anchor">#</a> Action 处理</h2> <p>现在我们已经确定了 state 对象的结构，就可以开始开发 reducer。reducer 就是一个纯函数，接收旧的 state 和 action，返回新的 state。</p> <h3 id="定义-action-creator"><a href="#定义-action-creator" class="header-anchor">#</a> 定义 action creator</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./actions/counter.js</span>
<span class="token comment">// ......</span>
<span class="token comment">/**
 * action creator，action创建函数，主要用于生成 action 对象
 * @returns 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">incrementActionCreator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">INCREMENT</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>action creator 主要用于创建 action，以便实现 action 复用时少写代码</p> <h3 id="创建-store"><a href="#创建-store" class="header-anchor">#</a> 创建 Store</h3> <p><strong>Store</strong> 就是把它们联系到一起的对象。Store 有以下职责：</p> <ul><li>维持应用的 state；</li> <li>提供 <code>[getState()](https://www.redux.org.cn/docs/api/Store.html#getState)</code> 方法获取 state；</li> <li>提供 <code>[dispatch(action)](https://www.redux.org.cn/docs/api/Store.html#dispatch)</code> 方法更新 state；</li> <li>通过 <code>[subscribe(listener)](https://www.redux.org.cn/docs/api/Store.html#subscribe)</code> 注册监听器;</li> <li>通过 <code>[subscribe(listener)](https://www.redux.org.cn/docs/api/Store.html#subscribe)</code> 返回的函数注销监听器。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./store/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> rootReducer <span class="token keyword">from</span> <span class="token string">'../reducers'</span>

<span class="token comment">// 创建 Store 对象</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span>
</code></pre></div><p>调用 createStore() 并传递根 reducer 作为参数，创建 Store 仓库对象</p> <h3 id="利用绑定库的-provider-保存-store"><a href="#利用绑定库的-provider-保存-store" class="header-anchor">#</a> 利用绑定库的 Provider 保存 store</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./src/index.js</span>
<span class="token comment">// ......</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>通常在 src/index.js 中引入绑定库的 Provider 与 redux 创建的 store，利用 Provider 组件包裹应用中的组件，在 Provider 中使用 store 属性保存 redux 的 Store，这样，在 Provider 组件的后代组件中，就可以去连接并使用 redux 的 store 了。</p> <h3 id="组件中连接-store"><a href="#组件中连接-store" class="header-anchor">#</a> 组件中连接 store</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./App.jsx</span>
<span class="token comment">// ......</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token comment">/**
 * 将 store 中 state 的数据映射到组件的属性中
 * mapStateToProps 是一个函数，会传递 store 中的 state 作为参数。
 * 返回一个普通对象，该对象会被合并到组件的 props 中
 * @param {*} state 
 * @returns 
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>count
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 将更新状态数据的动作映射到组件的属性中
 * mapDispatchToProps 是一个函数，会传递 dispatch 作为参数。
 * 返回一个对象，返回对象中的各字段应该是函数（方法），返回
 * 对象中的各字段也会被合并到组件的 props 中。
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">plus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">incrementActionCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">minus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">decrementActionCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* 调用 connect() 函数，在 React 组件中，连接 redux 的 store */</span>
<span class="token keyword">const</span> hoc <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">hoc</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
</code></pre></div><p>绑定库中的 connect() 方法主要用于在组件中连接 redux 的 store，传递 mapStateToProps 和 mapDispatchToProps 作为参数：两个参数都是函数的结构，函数中返回的对象会被合并到包裹的组件 props 属性中。</p> <p>connect() 返回值是一个函数包裹器（HOC），调用该包裹器函数并传递组件参数，可以实现将  mapStateToProps 和 mapDispatchToProps 返回值的对象各属性合并注入到组件的操作。</p> <h1 id="理解redux-自己"><a href="#理解redux-自己" class="header-anchor">#</a> 理解redux（自己）</h1> <ul><li>store：推送数据的仓库</li> <li>reducer：帮助 store 处理数据的方法（初始化、修改、删除）</li> <li>actions：数据更新的指令</li> <li>react 组件（UI）：订阅 store 中的数据</li></ul> <p>connect(mapStateToProps, mapDispatchToProps, mergeProps, _ref2) {</p> <h2 id="redux-三大原则"><a href="#redux-三大原则" class="header-anchor">#</a> redux 三大原则：</h2> <ul><li>单一数据源：整个应用的 state 存放在唯一的一个 store 中。<code>store.getState()</code></li> <li>state 是只读的，唯一改变 state 的方法就是触发 action，action 是一个用于描述已发生事件的普通对象。</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">store.dispatch(</span><span class="token punctuation">{</span>
  <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">'COMPLETE_TODO'</span><span class="token punctuation">,</span>
  <span class="token property">index</span><span class="token punctuation">:</span> 1
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>使用纯函数来执行修改（reducer：接收先前的 state 和 action，并返回新的 state）</li></ul> <p>纯函数：1、相同的输入总是会返回相同的输出，2、不会产生任何副作用、3、不依赖于外部状态</p> <h2 id="react-redux"><a href="#react-redux" class="header-anchor">#</a> react-redux</h2> <p><code>React-Redux</code> 将所有组 件分成两大类：<code>UI</code> 组件和容器组件。<code>UI</code> 组件负责 <code>UI</code> 的呈现，容器组件负责管理数据和逻辑。</p> <ul><li><code>UI</code> 组件：只负责 UI 的呈现，不带有任何业务逻辑；没有状态（即不使用 <code>this.state</code> 这个变量）；所有数据都由参数 <code>this.props</code> 提供；不使用任何 <code>Redux</code> 的 <code>API</code></li> <li>容器组件：负责管理数据和业务逻辑，不负责 <code>UI</code> 的呈现；带有内部状态；使用 <code>Redux</code> 的 <code>API</code>。</li></ul> <p><code>React-Redux</code> 规定，所有的 <code>UI</code> 组件都由用户提供，容器组件则是由 <code>React-Redux</code> 自动生成。也就是说，用户负责视觉层，状态管理则是全部交给它。</p> <p><code>React-Redux</code> 规定，所有的 <code>UI</code> 组件都由用户提供，容器组件则是由 <code>React-Redux</code> 自动生成。也就是说，用户负责视觉层，状态管理则是全部交给它。</p> <h3 id="connect"><a href="#connect" class="header-anchor">#</a> <strong>connect()</strong></h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">const</span> VisibleTodoList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span>
</code></pre></div><p>上面 <code>VisibleTodoList</code> 便是 <code>UI</code> 组件 <code>TodoList</code> 通过 <code>connect</code> 方法自动生成的容器组件。</p> <p><code>connect</code> 方法接受两个参数：<code>mapStateToProps</code> 和 <code>mapDispatchToProps</code>。它们定义了 <code>UI</code> 组件的业务逻辑。前者负责输入逻辑，即将 <code>state</code> 映射到 <code>UI</code> 组件的参数 <code>props</code>，后者负责输出逻辑，即将用户对 <code>UI</code> 组件的操作映射成 <code>Action</code>。</p> <p><strong>mapStateToProps()</strong></p> <p><code>mapStateToProps</code> 是一个函数，它接受 <code>state</code> 作为参数，返回一个对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>count
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>mapStateToProps</code> 建立一个从（外部的）<code>state</code> 对象到（<code>UI</code> 组件的）<code>props</code> 对象的映射关系。执行后应该返回一个对象，里面的每一个键值对就是一个映射。</p> <p><strong>mapDispatchToProps()</strong></p> <p><code>mapDispatchToProps</code> 用来建立 <code>UI</code> 组件的参数到 <code>store.dispatch</code> 方法的映射。它定义了哪些用户的操作应该当作 <code>Action</code>，传给 <code>Store</code>。它可以是一个函数，也可以是一个对象。</p> <ul><li>是函数则会得到 <code>dispatch</code> 和 <code>ownProps</code>（容器组件的 <code>props</code> 对象）两个参数。</li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">,</span> ownProps<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'SET_VISIBILITY_FILTER'</span><span class="token punctuation">,</span>
        filter<span class="token operator">:</span> ownProps<span class="token punctuation">.</span>filter<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="provider-组件"><a href="#provider-组件" class="header-anchor">#</a> Provider 组件</h3> <p><code>connect</code> 方法生成容器组件以后，需要让容器组件拿到 <code>state</code> 对象，才能生成 <code>UI</code> 组件的参数。
<code>React-Redux</code> 提供 <code>Provider</code> 组件，使整个 <code>app</code> 访问到 <code>Redux store</code> 中的数据 即<code>state</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 入口文件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token comment">// 利用provider保存store</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
   <span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2e62b62d.js" defer></script><script src="/assets/js/2.63c13255.js" defer></script><script src="/assets/js/19.40c015fe.js" defer></script>
  </body>
</html>
